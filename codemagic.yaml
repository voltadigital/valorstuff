workflows:
  Build App For IOS and ANDROID:
    instance_type: mac_mini
    scripts:
      - name: Download Required Packages
        script: |
                  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
                  echo "----------------------------------------------------------------------------------"
                  sudo ln -sfn /usr/local/opt/openssl /usr/local/ssl
                  echo "----------------------------------------------------------------------------------"
                  brew install pkg-config sdl2 sdl2_image sdl2_ttf sdl2_mixer gstreamer autoconf automake 
                  echo "----------------------------------------------------------------------------------"
                  python3 -m pip install --upgrade pip
                  echo "----------------------------------------------------------------------------------"
                  pip3 install --user --upgrade buildozer cython kivy aiohttp kivymd asynckivy virtualenv kivy-ios
                  echo "----------------------------------------------------------------------------------"
                  cd ../ && wget https://download.java.net/java/GA/jdk13.0.2/d4173c853231432d94f001e99d882ca7/8/GPL/openjdk-13.0.2_osx-x64_bin.tar.gz && tar xf openjdk-13.0.2_osx-x64_bin.tar.gz && sudo mv jdk-13.jdk /Library/Java/JavaVirtualMachines/ && export  JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk-13.jdk/Contents/Home
      
      - name: Remove Unused Files
        script: |
                  sudo rm -r $HOME/programs/flutter
                  sudo rm /Applications/Xcode-13.3.app
                  sudo rm /Applications/Xcode-14.0.app
                  sudo rm -r /Users/builder/.android/avd/emulator.avd
                  sudo rm -r /Library/Java/JavaVirtualMachines/zulu-18.jdk
                  sudo rm -r /Library/Java/JavaVirtualMachines/zulu-16.jdk
                  sudo rm -r /Library/Java/JavaVirtualMachines/zulu-11.jdk
                  sudo rm -r /Library/Java/JavaVirtualMachines/zulu-8.jdk
                  java -version
 
      - name: Run Buildozer
        script: |
                  buildozer android release || { echo 'ANDROID FAILIURE' ; exit 1; }
                  echo "----------------------------------------------------------------------------------"
                  buildozer ios release || { echo 'IOS FAILIURE' ; exit 1; }

    artifacts:
      - ./bin/*.aab
      - ./bin/*.apk
      - ./bin/*.aar
      - ./bin/*.app
      - ./bin/*.ipa
      - ./bin/*.pkg
      - ./bin/*.jar
      - ./bin/*.zip
      - ./bin/*.xarchive